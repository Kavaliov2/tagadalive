include('auto');

init()

var enemy = Fight.getEntity(getNearestEnemy());

// approche + attaque
var comboOld = MapDanger.getPotentialCombo(Fight.self, enemy.cell)
debug("Combo only offensive item from MapDanger:")
debug(comboOld)
var combo = MapAction.getPotentialCombo(Fight.self)
debug("New Combo allstuff, from 1 cell, with MapAction:")
debug(combo)
if(combo && count(combo.actions)>0) combo.play()
else {
	debugE('SHOULD NOT BE HERE !')
}

// cast avec le reste des TP
function failSafe(){
	var tpleft = getTP()
	//Items.getItem(CHIP_MOTIVATION).useItem(Fight.self)
	if(getAbsoluteShield(Fight.self)<=0) Items.getItem(CHIP_SHIELD).useItem(Fight.self)
	if(getAbsoluteShield(Fight.self)<=0) Items.getItem(CHIP_HELMET).useItem(Fight.self)
	if(Fight.self.lifeMissing>0){
		Items.getItem(CHIP_CURE).useItem(Fight.self)
		Items.getItem(CHIP_BANDAGE).useItem(Fight.self)
	}
	Items.getItem(CHIP_PROTEIN).useItem(Fight.self)
	//if(getRelativeShield(Fight.self)<=0) Items.getItem(CHIP_WALL).useItem(Fight.self)
	debug("failSafe TP used: "+(tpleft-getTP()))
}
failSafe()
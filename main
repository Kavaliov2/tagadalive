include('auto');

function init() {
	if(getTurn()==1) {
		Map()
		Items()
	} 
	Fight()
	MapDanger()
}
init() 


if(getWeapon()==null) setWeapon(WEAPON_PISTOL);
var enemy = Entity(getNearestEnemy());

// debug qui affiche les cases safe en vert et avec du danger en rouge
for(var c : var d in Fight.self.reachableCells) {
	var danger = MapDanger.getCellDanger(c)
	if(danger > 0) { 
		mark(c, COLOR_RED)
	}
	else {
		mark(c, COLOR_GREEN)
	}
}

var cellToUsePistol = getCellToUseWeapon(enemy.id)
var path = getPath(getCell(), cellToUsePistol)
if(count(path)>getMP()){ // avance prudente
	for(var cell in path){
		var danger = MapDanger.getCellDanger(cell)
		if(danger == 0) moveTowardCell(cell)
	}
} else { // je peux tirer sur l'adv: gogo
	moveTowardCell(cellToUsePistol)
}

// On essaye de lui tirer dessus !
while(useWeapon(enemy.id) > 0);

if(getMP()>0){ // on se cache si possible !
	Fight.self.refresh()
	var safeCell = null, tmpDanger = 9999999
	for(var cell:var mp in Fight.self.reachableCells){
		var danger = MapDanger.getCellDanger(cell)
		if(tmpDanger > danger) {
			safeCell = cell
			tmpDanger = danger
		}
	}
	moveTowardCell(safeCell)
}
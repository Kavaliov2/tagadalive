include('../auto')

class TargetType {
	enemies = false
	allies = false
	
	onBulbs = false // FIXME le nomage bulb/leek pu, summon/notsummon est très moche, maybe summon/primary ?
	onLeeks = false
	onCaster = false
	// TODO when onCaster, peut justifier des cibles autres que celle normalement autorisé par les types d'effet
	// exemple broadsword / j_lazer
	// TODO target empty cell for item that target nothing : summon, resu, teleport, broadsword to selfboost, etc... ?

	static NONE = 0
	static ENEMIES = 1
	static ALLIES = 2
	static ALL = 3
	
	static CONVERTER = [
		EFFECT_DAMAGE: TargetType.ENEMIES,
		EFFECT_POISON: TargetType.ENEMIES,
		EFFECT_NOVA_DAMAGE: TargetType.ENEMIES,
		EFFECT_LIFE_DAMAGE: TargetType.ENEMIES,
		EFFECT_VULNERABILITY: TargetType.ENEMIES,
		EFFECT_ABSOLUTE_VULNERABILITY: TargetType.ENEMIES,
		EFFECT_KILL: TargetType.ENEMIES,
		
		EFFECT_ANTIDOTE: TargetType.ALLIES,
		EFFECT_REMOVE_SHACKLES: TargetType.ALLIES,
		EFFECT_HEAL: TargetType.ALLIES,
		EFFECT_BOOST_MAX_LIFE: TargetType.ALLIES,
		EFFECT_RAW_ABSOLUTE_SHIELD: TargetType.ALLIES,
		EFFECT_RAW_BUFF_AGILITY: TargetType.ALLIES,
		EFFECT_RAW_BUFF_MAGIC: TargetType.ALLIES,
		EFFECT_RAW_BUFF_MP: TargetType.ALLIES,
		EFFECT_RAW_BUFF_RESISTANCE: TargetType.ALLIES,
		EFFECT_RAW_BUFF_SCIENCE: TargetType.ALLIES,
		EFFECT_RAW_BUFF_STRENGTH: TargetType.ALLIES,
		EFFECT_RAW_BUFF_TP: TargetType.ALLIES,
		EFFECT_RAW_BUFF_WISDOM: TargetType.ALLIES,
		EFFECT_BUFF_AGILITY: TargetType.ALLIES,
		EFFECT_BUFF_FORCE: TargetType.ALLIES,
		EFFECT_BUFF_MP: TargetType.ALLIES,
		EFFECT_BUFF_RESISTANCE: TargetType.ALLIES,
		EFFECT_BUFF_STRENGTH: TargetType.ALLIES,
		EFFECT_BUFF_TP: TargetType.ALLIES,
		EFFECT_BUFF_WISDOM: TargetType.ALLIES,
		EFFECT_ABSOLUTE_SHIELD: TargetType.ALLIES,
		EFFECT_RELATIVE_SHIELD: TargetType.ALLIES,
		EFFECT_DAMAGE_RETURN: TargetType.ALLIES,
		EFFECT_NOVA_VITALITY: TargetType.ALLIES,
		EFFECT_REMOVE_SHACKLES: TargetType.ALLIES,
		
		
		//EFFECT_AFTEREFFECT: 
		EFFECT_ATTRACT: TargetType.ALL,
		EFFECT_DEBUFF: TargetType.ALL,
		EFFECT_INVERT: TargetType.ALL,
		EFFECT_PUSH: TargetType.ALL,
		
		// EFFECT_STEAL_ABSOLUTE_SHIELD:
		
		
		EFFECT_RESURRECT: TargetType.NONE, // FIXME ???
		EFFECT_TELEPORT: TargetType.NONE
		EFFECT_SUMMON: TargetType.NONE
	]

	constructor(effect){
		var tt = TargetType.CONVERTER[effect.type]
		if(!tt) debugE('unhandled type in TargetType on effect: ' + effect)
		if(tt == TargetType.ENEMIES) this.enemies = true
		else if(tt == TargetType.ALLIES) this.allies = true
		else if(tt == TargetType.ALL){
			this.enemies = true
			this.allies = true
		}
		// else everything should be on false for .NONE
		this.onCaster = effect.targets & EFFECT_TARGET_CASTER
		if(!(effect.targets & EFFECT_TARGET_ALLIES)) this.allies = false
		if(!(effect.targets & EFFECT_TARGET_ENEMIES)) this.enemies = false
		if(effect.targets & EFFECT_TARGET_SUMMONS) this.onBulbs = true
		if(effect.targets & EFFECT_TARGET_NON_SUMMONS) this.onLeeks = true
	}
}